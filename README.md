<p align="center">
  <picture>
    <source media="(prefers-color-scheme: dark)" srcset="./assets/logo-dark.png">
    <source media="(prefers-color-scheme: light)" srcset="./assets/logo-light.png">
    <img alt="vericontext" src="./assets/logo-light.png" width="360">
  </picture>
</p>

<h3 align="center">Docs lie. Hashes don't.</h3>

<p align="center">
  Deterministic, hash-based verification for docs that reference code.<br>
  Fail-closed. Zero fuzzy matching. One stale citation â†’ entire doc fails.
</p>

<!-- BADGES:START -->
<!-- generated by add-badges 2026-02-23 -->
<p align="center">
  <a href="https://www.npmjs.com/package/vericontext"><img src="https://img.shields.io/npm/v/vericontext?style=flat-square&logo=npm&logoColor=white" alt="npm version"></a>
  <a href="LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue?style=flat-square" alt="License: MIT"></a>
  <a href="https://www.typescriptlang.org/"><img src="https://img.shields.io/badge/TypeScript-strict-3178C6?style=flat-square&logo=typescript&logoColor=white" alt="TypeScript"></a>
  <a href="https://modelcontextprotocol.io"><img src="https://img.shields.io/badge/MCP-compatible-8A2BE2?style=flat-square" alt="MCP compatible"></a>
  <a href="package.json"><img src="https://img.shields.io/badge/node-%3E%3D20-339933?style=flat-square&logo=nodedotjs&logoColor=white" alt="Node >= 20"></a>
</p>
<!-- BADGES:END -->

<p align="center">
  <b>English</b> Â·
  <a href="README-ko.md">í•œêµ­ì–´</a>
</p>

<p align="center">
  <a href="#the-problem">Why</a> Â·
  <a href="#setup">Setup</a> Â·
  <a href="#github-actions">CI</a> Â·
  <a href="#how-it-works">How It Works</a> Â·
  <a href="#cli-reference">CLI</a>
</p>

---

## The Problem

AI coding agents now scatter `README.md` and `AGENTS.md` across every directory â€” `deep init` style. It works great until the code changes and the docs don't. Files move, functions get rewritten, but the docs still say *"this logic lives in `src/handler.ts` at L30-L45."*

Over time, **your docs become liars.** And agents that trust those docs make worse decisions.

VeriContext embeds a **SHA-256 content hash** into every code citation at write time. When you verify later, either the hash matches or it doesn't. No fuzzy recovery. No "close enough."

```
Write time:    "handler logic" [[vctx:src/handler.ts#L30-L45@a1b2c3d4]]
After change:  vericontext verify â†’ âŒ hash_mismatch (a1b2c3d4 â‰  f5e6d7c8)
```

**One broken citation â†’ entire doc fails.** Fail-closed by design.

## Setup

```bash
npx skills add amsminn/vericontext --skill vericontext-enforcer
```

Detects your agent (Claude Code, Codex, Antigravity, Cursor, Windsurf, OpenCode, â€¦) and installs to the right path. Supports [40+ agents](https://github.com/vercel-labs/skills).

To uninstall:

```bash
npx skills remove vericontext-enforcer
```

Once installed, the agent automatically:
- Inserts `[[vctx:...]]` citations when referencing code in docs
- Runs `vctx_verify_workspace` before commits and plan finalization
- Flags stale citations for update

<details>
<summary>Manual install per agent</summary>

The skill lives at `skills/vericontext-enforcer/SKILL.md` in this repo. Copy it to the right place for your agent:

| Agent | Skill path | Also needs MCP? |
|-------|-----------|-----------------|
| **Claude Code** | `.claude/skills/vericontext-enforcer/` | No (skill handles it) |
| **Antigravity** | `~/.gemini/antigravity/skills/vericontext-enforcer/` | No |
| **Codex** | `.codex/skills/vericontext-enforcer/` | Yes |
| **Cursor** | `.cursor/rules/vericontext.mdc` | Yes |
| **Windsurf** | `.windsurf/rules/vericontext.md` | Yes |
| **OpenCode** | Project rules | Yes |

For agents that need MCP, add the server to your config:

```json
{ "mcpServers": { "vericontext": { "command": "npx", "args": ["-y", "vericontext", "mcp"] } } }
```

MCP tools exposed: `vctx_cite`, `vctx_claim`, `vctx_verify_workspace`

</details>

## GitHub Actions

Add a step to any workflow:

```yaml
- name: Verify docs
  run: npx -y vericontext verify workspace --root . --in-path README.md --json
```

Stale citation â†’ CI red.

### Pre-commit Hook

```bash
# .husky/pre-commit
npx vericontext verify workspace --root . --in-path README.md --json
```

## How It Works

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    cite     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   file   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚ [[vctx:path#L1-L2@<sha256-8>]]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   verify    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   file   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚  hash match? â†’ ok : hash_mismatch  â”‚
â”‚(changed?)â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

1. **Cite** â€” snapshot a file's line range with its SHA-256 hash
2. **Claim** â€” declare structure facts: `exists-file`, `exists-dir`, `missing`
3. **Verify** â€” check every citation and claim in a doc. One failure â†’ whole doc fails

### Claim Syntax

```
Citation:    [[vctx:<path>#L<start>-L<end>@<hash8>]]
Exists:      [[vctx-exists:<path>]]
Exists-file: [[vctx-exists-file:<path>]]
Exists-dir:  [[vctx-exists-dir:<path>/]]
Missing:     [[vctx-missing:<path>]]
```

Claims can be hidden in HTML comments so they don't clutter the doc:

```html
The auth module handles login.
<!-- [[vctx:src/auth.ts#L1-L50@abcd1234]] -->
```

### Features

| | Feature | Description |
|---|---|---|
| # | **Hash citations** | Cite file line ranges with SHA-256 content hashes |
| ğŸ“ | **Structure claims** | Assert `exists`, `exists-file`, `exists-dir`, `missing` |
| ğŸ”’ | **Fail-closed** | One broken claim â†’ entire verification fails |
| ğŸš§ | **Root jail** | Repo-relative paths only. `../` traversal blocked |
| ğŸ“Ÿ | **CLI + MCP** | Same logic as both CLI and MCP stdio server |
| ğŸ”¤ | **Deterministic** | UTF-8 only, LF-normalized, symlinks and binaries skipped |

## CLI Reference

<details>
<summary><b>Install</b></summary>

```bash
npm install -g vericontext
```

Or use directly via `npx`:

```bash
npx vericontext --help
```

</details>

<details>
<summary><code>cite</code> â€” generate a code citation</summary>

```bash
npx vericontext cite --root <dir> --path <file> --start-line <n> --end-line <n> [--json]
```

| Option | Required | Description |
|--------|----------|-------------|
| `--root` | Yes | Repository root directory |
| `--path` | Yes | File path relative to root |
| `--start-line` | Yes | Start line (1-based) |
| `--end-line` | Yes | End line (1-based) |
| `--json` | No | JSON output |

</details>

<details>
<summary><code>claim</code> â€” generate a structure claim</summary>

```bash
npx vericontext claim --root <dir> --kind <kind> --path <path> [--json]
```

`--kind`: `exists` | `exists-file` | `exists-dir` | `missing`

</details>

<details>
<summary><code>verify workspace</code> â€” verify all claims in a document</summary>

```bash
npx vericontext verify workspace --root <dir> (--in-path <doc> | --text <text>) [--json]
```

| Exit Code | Meaning |
|-----------|---------|
| `0` | All citations and claims valid |
| `1` | One or more failures, or input error |

```json
{
  "ok": false,
  "total": 5,
  "ok_count": 4,
  "fail_count": 1,
  "results": [
    { "claim": "[[vctx:src/foo.ts#L1-L3@deadbeef]]", "ok": false, "reason": "hash_mismatch" }
  ]
}
```

</details>

<details>
<summary><b>Error reasons</b></summary>

| Reason | Meaning |
|--------|---------|
| `hash_mismatch` | Cited content has changed |
| `file_missing` | File does not exist |
| `path_escape` | Path escapes root jail |
| `range_invalid` | Line range out of bounds |
| `binary_file` | Binary file (null byte detected) |
| `symlink_skipped` | Symlink (skipped for determinism) |
| `invalid_input` | Malformed input |

</details>

## Self-Verifying Docs

This README itself contains hidden VeriContext claims and is verifiable:

<!-- [[vctx-exists-dir:src/]] -->
<!-- [[vctx-exists-file:src/cli.ts]] -->
<!-- [[vctx-exists-file:src/mcp/server.ts]] -->
<!-- [[vctx-missing:tmp-output/]] -->

```bash
npx vericontext verify workspace --root . --in-path README.md --json
```

## Contributing

See [CONTRIBUTING.md](CONTRIBUTING.md).

## License

[MIT](LICENSE)
